!function(e,t){var n=e.location,r=t.currentScript;function a(e,t){return r&&r.dataset[e]||t}function o(e,t){return parseInt(a(e,t),10)}var i=o("timeout","3000"),s=o("history","20"),u=a("settle","class,style,width,height").split(","),c=a("insert-class","ts-insert"),l=a("remove-class","ts-remove"),f=a("active-class","ts-active"),d=!1,h=[],p={stop:function(e){e.event&&e.event.stopPropagation()},prevent:function(e){e.event&&e.event.preventDefault()},delay:function(e){return new Promise(function(t){setTimeout(t,T(e),!0)})},not:function(e){var t=[].slice.call(arguments,1,arguments.length-1),n=g({},arguments[arguments.length-1]);n.src=n.src.slice(n.command.length+1);var r=pe(e,t,n);return null==r?r:!r},target:function(e,t){try{let n=Q(t.el,e);return!!n&&void(t.el=n)}catch(e){return!1}},remove:v(e=>{e.el.remove()},(e,t)=>{Q(t.el,e).remove()}),wait:function(e,t){return new Promise(function(n){I(t.el,e,n,{once:!0})})},on:function(e,t){var n=me(t.line.split(t.src)[1].replace(/^[\s,]+/,""))[0];return Ne(t.el,e,(e,r)=>{ve(n,{el:t.el,event:r})}),!1},req:v((e,t)=>{this.dispatcher(null,e,t)},(e,t,n)=>{ce(de(n.el,n.event,!1,{method:e,url:t,data:n.input?[["input",n.input]]:null}))}),class:function(e,t){t.el.classList.add(e)},"class+":function(e,t){t.el.classList.add(e)},"class-":function(e,t){t.el.classList.remove(e)},"class^":function(e,t){t.el.classList.toggle(e)},classtoggle:function(e,t){t.el.classList.toggle(e)},text:v(e=>(null!==e.input&&void 0!==e.input&&(e.el.textContent=e.input),e.input),(e,t)=>(t.el.textContent=e,e)),html:v(e=>(null!==e.input&&void 0!==e.input&&(e.el.innerHTML=e.input),e.el.innerHTML),(e,t)=>(t.el.innerHTML=e,e)),attr:v((e,t)=>{let n=t.el[e];return void 0!==n?n:k(t.el,e)},(e,t,n)=>(n.el[e]=t,A(n.el,e,t),t)),log:function(...e){let t=e[e.length-1],n=e.slice(e.length-1);t.input&&n.push(t.input),console.log(...n)}},m=console.error?console.error.bind(console,"TwinSpark error:"):console.log.bind(console,"TwinSpark error:");function v(...e){let t=e.reduce((e,t)=>{if(e[t.length])throw y("Arity dispatch: duplicate function with the same number of arguments",{length:t.length,func:t,duplicate:e[t.length]});return e[t.length]=t,e},{});return function e(){var n=arguments.length,r=t[n];if(!r)throw y("No function supplied accepting "+n+" arguments",{functions:t,arguments:Array.from(arguments)});return r.apply({dispatcher:e},arguments)}}var g=Object.assign||function(e,t){if(!t)return e;for(var n in t)Object.hasOwn(t,n)&&(e[n]=t[n]);return e};function b(e){return e.outerHTML.match(/<.+?>/)[0]}function y(e,t){var n=Error(e);return n.extra=t,n}function w(e){var t=null;return function(){return t||(t=e())}}function T(e){if(e=e&&e.trim())return e.match(/\d+s/)?1e3*parseFloat(e):parseFloat(e)}function E(e){"loading"==t.readyState?t.addEventListener("DOMContentLoaded",e):e()}var S=e.requestIdleCallback||function(e){setTimeout(e,100)};function N(e,t,n,r){var a=!r||!("bubbles"in r)||r.bubbles,o=new CustomEvent(t,{bubbles:a,cancelable:!0,detail:n});return console.debug("🛎️ EVENT",t,{el:e,detail:n}),e.dispatchEvent(o),o}function x(e,t,n){N(e,t,g({error:t},n))}function q(e,t){return e.hasAttribute(t)}function k(e,t){return e.getAttribute(t)}function A(e,t,n){return e.setAttribute(t,n)}function L(e,t){return e.removeAttribute(t)}function C(e,t){return 1==e.nodeType&&e.matches(t)?e:e.querySelector?e.querySelector(t):null}function O(e,t){if(!e.querySelectorAll)return[];var n=Array.from(e.querySelectorAll(t));return 1==e.nodeType&&e.matches(t)&&n.unshift(e),n}function R(e){if(e.id)return e.id;var t=e.tagName.toLowerCase();return e.className?t+"."+e.className.replace(" ","."):t}function M(e,t){var n,r=[],a=e;do{(n=k(a,t))&&r.push(n)}while(a=a.parentElement);return r}function P(e,t,n){var r="twinspark-internal",a=e[r]||(e[r]={});return t?(t in a||void 0===n||(a[t]=n),a[t]):a}function D(e,n){var r={selector:e,handler:n};h.push(r),d&&O(t.body,r.selector).forEach(r.handler)}function I(e,t,n,r){return e.addEventListener(t,n,r),P(e,"event-handlers",[]).push({type:t,func:n,opts:r}),e}function H(e){P(e,"event-handlers",[]).forEach(t=>e.removeEventListener(t.type,t.func,t.opts))}function U(e){H(e),h.forEach(t=>e.matches(t.selector)&&t.handler(e))}function F(e){O(e,h.map(e=>e.selector).join(",")).forEach(U),N(e,"ts-ready")}function j(e,t,n){if(!t)return e;for(var[r,a]of t)r&&(!n||null!==a&&""!==a?e.append(r,a):e.delete(r));return e}function B(e,t){return M(e,t).reduceRight((e,t)=>j(e,function(e){if(""==e)return null;if("{"!=e[0])return j(new FormData,new URLSearchParams(e));var t=JSON.parse(e);if("object"==typeof t&&null!==t){var n=[];for(var r in t)n.push([r,t[r]]);return n}}(t),!0),new FormData)}function _(e){return e.name?"submit"==e.type?null:"radio"!=e.type&&"checkbox"!=e.type||e.checked?e.value:null:null}function G(e,t){var n,r=B(e,"ts-data"),a=e.tagName;if("FORM"==a){let n=new FormData(e);t&&t.submitter&&t.submitter.name&&t.submitter.value&&!n.has(t.submitter.name)&&r.append(t.submitter.name,t.submitter.value),r=j(r,n)}else"INPUT"!=a&&"SELECT"!=a&&"TEXTAREA"!=a||(n=_(e))&&r.append(e.name,n);return r}var V,$=e.indexedDB;function K(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function X(){if(V)return V;var e="twinspark",t=$.open(e,1);return t.onupgradeneeded=function(){t.result.createObjectStore(e,{keyPath:"url"}).createIndex("time","time")},V=K(t)}function W(e,t){var n=t&&t.write;return e.transaction(e.name,n?"readwrite":"readonly").objectStore(e.name)}async function Y(){if(0!=s){var e={url:n.pathname+n.search,html:t.body.innerHTML,time:+new Date},r=await X(),a=W(r,{write:!0});await K(a.put(e)),await async function(e){let t=W(e),n=await K(t.count());console.debug("PAGES IN STORAGE",n);var r=n-s;if(r<=0)return;t=W(e,{write:!0});let a=t.index("time").openCursor();a.onsuccess=function(e){var t=a.result;t&&(t.delete(),--r>0&&t.continue())}}(r)}}async function z(e){if(0==s)return;if(!e.state)return;let r=n.pathname+n.search,a=W(await X()),o=await K(a.get(r));if(o&&o.html){if(console.debug("onpopstate restore",o.url,o.html.length,o.time),H(t),t.body.innerHTML=o.html,"INITIAL"==e.state&&!d)return;F(t.body)}}function J(e,n,r){var a=function(e,n,r){return n&&e?"target"==n?e:"inherit"==n?Q(e.parentElement.closest("[ts-target]")):"parent "==n.slice(0,7)?e.closest(n.slice(7)):"child "==n.slice(0,6)?e.querySelector(n.slice(6)):"sibling "==n.slice(0,8)?e.parentElement.querySelector(n.slice(8)):r?e.querySelector(n):t.querySelector(n):e}(e,n,r);if(a)return a;var o=b(e);throw y(`Could not find element with selector ${n} for element ${o}`+(r?" among children":""),{element:o,selector:n})}function Q(e,t){return e?(null==t&&(t=k(e,"ts-target")),t?t.split("|").map(e=>e.trim()).reduce((e,t,n)=>J(e,t,n>0),e):e):e}function Z(e,t,n,r){if(r){let r=t[n];r!=e[n]&&(e[n]=r,null===r||!1===r?L(e,n):A(e,n,r))}else{let r=k(t,n);r!=k(e,n)&&(null===r||!1===r?L(e,n):A(e,n,r))}}function ee(e,t){for(var n of u)Z(e,t,n)}function te(e){e.classList.add(c),setTimeout(()=>e.classList.remove(c))}var ne=function(){function n(t,n){if(n.cb("node-remove",t),1==t.nodeType){t.classList.add(l);var r=t.getAnimations().filter(t=>t instanceof e.CSSTransition);if(!r.length)return t.remove();Promise.all(r.map(e=>e.finished)).then(()=>{t.remove()})}else t.remove()}function r(e,t){t.cb("node-insert",e),e instanceof HTMLElement&&(F(e),te(e))}function a(e,t){if(1==e.nodeType){for(let n=e.attributes.length-1;n>=0;n--)Z(e,t,e.attributes[n].name);for(var n of t.attributes)Z(e,t,n.name);"INPUT"==e.tagName&&"file"!=e.type?(Z(e,t,"value",!0),Z(e,t,"checked",!0),Z(e,t,"disabled",!0)):"OPTION"==e.tagName?Z(e,t,"selected",!0):"TEXTAREA"==e.tagName&&(Z(e,t,"value"),e.firstChild&&e.firstChild.nodeValue!=t.value&&(e.firstChild.nodeValue=t.value))}else e.nodeValue=t.nodeValue}function o(e,t){const n=new Set;for(const r of t)e.has(r)&&n.add(r);return n}function i(e,t){return e&&t&&e.nodeType==t.nodeType&&e.tagName==t.tagName}function s(e,t){if(1!=t.nodeType)return null;var n=t,r=O(n,"[id]").map(e=>"#"+CSS.escape(e.id)).join(",");if(!r)return null;n=e;do{if(C(n,r))return n}while(n=n.nextElementSibling);return null}function u(e,t,n){var r=e,a=t.nextSibling,s=0;do{var u=O(r,"[id]").map(e=>e.id);if(u.length&&o(n,u).size)return null;if(!u.length&&!O(t,"[id]").length&&i(r,t))return r;if(i(r,a)&&(s++,a=a.nextSibling,s>=2))return null}while(r=r.nextSibling);return null}function c(e,t,r){for(;e!==t;){var a=e;e=e.nextSibling,n(a,r)}return t}function f(e,o,l){return!l.ignoreActive||e!=t.activeElement||"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName?o?i(e,o)?(a(e,o),1==e.nodeType&&1==o.nodeType&&function(e,t,a){e instanceof HTMLTemplateElement&&t instanceof HTMLTemplateElement&&(e=e.content,t=t.content);var o=e.firstChild,i=t.firstChild,l=new Set(O(t,"[id]").map(e=>e.id));for(;i;){var d=i;if(i=d.nextSibling,o){var h=s(o,d);if(h)o=c(o,h,a).nextSibling,f(h,d,a);else{var p=u(o,d,l);p?(o=c(o,p,a).nextSibling,f(p,d,a)):(e.insertBefore(d,o),r(d,a))}}else e.appendChild(d),r(d,a)}o&&n(o=c(o,e.lastChild,a),a)}(e,o,l),e):(e.parentElement?(e.parentElement.insertBefore(o,e.nextSibling),n(e,l),r(o,l)):e.replaceWith(o),o):(n(e,l),null):e}function d(e,t,n={}){return n.cb||(n.cb=function(){}),e&&e.nodeType==Node.DOCUMENT_NODE&&(e=e.documentElement),t&&t.nodeType==Node.DOCUMENT_NODE&&(t=t.documentElement),f(e,t,n)}return d.syncAttrs=a,d}();function re(e,t,n,r){e||(e="replace"),"morph"!=e&&"morph-all"!=e&&"skip"!=e&&O(n,"[id]").forEach(function(e){!function(e,t,n){if(e.id){var r=t.querySelector(e.tagName+"[id='"+e.id+"']");if(!r)return te(e);var a=e.cloneNode();ee(e,r),n.tasks.push(function(){ee(e,a)})}}(e,t,r)});var a=n instanceof DocumentFragment&&Array.from(n.children);switch(e){case"morph-all":n=ne(t,n,{ignoreActive:!1});break;case"morph":n=ne(t,n,{ignoreActive:!0});break;case"replace":t.replaceWith(n);break;case"inner":t.replaceChildren(n);break;case"prepend":t.prepend(n);break;case"append":t.append(n);break;case"beforebegin":t.parentNode.insertBefore(n,t);break;case"afterend":t.parentNode.insertBefore(n,t.nextSibling);break;case"skip":break;default:throw Error("Unknown swap strategy "+e)}return a||[n]}function ae(e,t,n){var r=Q(e);if(!r)throw y(`Target element not found for origin ${b(e)}`,{origin:e,replyParent:t});var a=function(e,t,n){var r=k(t,"ts-req-selector");if(!r)return"BODY"==n.tagName&&"BODY"!=e.tagName?n.children[0]:n;if("children "==r.slice(0,9)){var a=C(n,r.slice(9)),o=new DocumentFragment;return a&&a.children&&o.append.apply(o,a.children),o}return C(n,r)}(r,e,t);if(!a){var o=k(e,"ts-req-selector");throw y(`Cannot find specified html in response, maybe nothing to select as ${o}`,{sel:o,replyParent:t,origin:e})}var i=k(e,"ts-swap");if(e){var s={response:n.response};ge(e,N(e,"ts-req-after",s),k(e,"ts-req-after"),s)}return re(i,r,a,n)}function oe(e){for(var n=e.parentNode,r=t.createElement(e.nodeName),a=0;a<e.attributes.length;a++){var o=e.attributes[a].name;A(r,o,k(e,o))}r.appendChild(t.createTextNode(e.innerHTML)),n.replaceChild(r,e)}function ie(e,n,r){var a,o,i,s,u={response:r,tasks:[]},c=[],l=1==e.length?e[0]:null;return"skip"!=r.headers["ts-swap"]&&(c=l?ae(l,n,u):(i=e,s=n.children,i.map((e,t)=>[e,s[t]])).flatMap(([e,t])=>ae(e,t,u))),a=O(n,"[ts-swap-push]").flatMap(e=>{try{return function(e,n,r){var a=k(n,"ts-swap-push");!a&&n.id&&(a="#"+n.id);var o=Q(Q(e||t.body),a);if(!o)throw y("cannot find target for server-pushed swap",{reply:n});return re(k(n,"ts-swap"),o,n,r)}(l,e,u)}catch(e){console.error(e)}}),r.headers["ts-swap-push"]&&(o=r.headers["ts-swap-push"].split(",").flatMap(e=>{try{return function(e,n,r,a){var o=e.match(/(\w+):(.+)<=(.+)/);if(!o)throw y("Cannot parse ts-swap-push header value",{header:e});var i=o[1],s=Q(Q(n||t.body),o[2]);if(!s)throw y("cannot find target for header swap",{sel:o[2]});var u=C(r,o[3]);if(!u)throw y("cannot find target for header swap",{reply:u,sel:o[3]});return re(i,s,u,a)}(e,l,n,u)}catch(e){console.error(e)}})),c=c.flat(),a&&(c=c.concat(a.flat())),o&&(c=c.concat(o.flat())),c=function(e){for(var t,n=new Set,r=[],a=0;a<e.length;a++)t=e[a],n.has(t)||(n.add(t),r.push(t));return r}(c),c.forEach(function(e){!function(e){for(var t=e.querySelectorAll("script"),n=0;n<t.length;n++){var r=t[n];r.type&&"text/javascript"!=r.type||r.dataset.tsNoload||oe(r)}}(e),F(e),function(e){var t=C(e,"[autofocus]");t&&t.focus()}(e)}),setTimeout(function(){u.tasks.forEach(function(e){e()})},16),c}function se(t,n,r,a){var o=(new DOMParser).parseFromString(r,"text/html");o.body.querySelectorAll("noscript").forEach(e=>e.remove());var i=a.headers["ts-title"]||o.title,s=o.body;if(s.children.length<n.length&&"skip"!=a.headers["ts-swap"])throw`This request needs at least ${n.length} elements, but ${s.children.length} were returned`;var u=a.headers["ts-history"]||q(n[0],"ts-req-history")&&t;return u&&("replace"==k(n[0],"ts-req-history")?function(t){history.replaceState("history","",t),N(e,"ts-replacestate",{url:t})}(u):function(t,n){Y(),history.replaceState("history","",""),history.pushState(null,n,t),N(e,"ts-pushstate",{url:t})}(u,i)),ie(n,s,a)}function ue(e){if(!e.length)return;var r,a=e[0].url,o=e[0].method;let s=k(e[0].el,"ts-json");if(s){if(e.length>1)throw y("Cannot batch json requests",{batch:e});r=s,e[0].opts.headers["Content-Type"]="application/json"}else r=e.reduce(function(e,t){return j(e,t.opts.data)},new FormData);var u="GET"==o?new URLSearchParams(r).toString():null,c="GET"!=o?r:null,l={method:o,xhr:e.reduce(function(e,t){return t.opts.xhr},{}),headers:e.reduce(function(e,t){return function(e,t){for(var n in t)e[n]?e[n]!=t[n]&&(e[n]+=", "+t[n]):e[n]=t[n];return e}(e,t.opts.headers)},{})};l=function(e,t){if(!t)return e;if("string"==typeof t||!Array.from(t.entries()).every(e=>"string"==typeof e[1]))return e.body=t,e;var n=new URLSearchParams(t);return e.body=n.toString(),e.headers["Content-Type"]="application/x-www-form-urlencoded",e}(l,c);var d=a;u&&(d+=-1==a.indexOf("?")?"?":"&",d+=u);var h=e.map(function(e){return e.el}),p=function(e,t){var n=new XMLHttpRequest;return{promise:new Promise(function(r,a){for(var o in t||(t={}),n.open(t.method||"GET",e,!0),t.headers)n.setRequestHeader(o,t.headers[o]);for(var o in t.xhr)n[o]=t.xhr[o];n.onreadystatechange=function(){if(4==n.readyState&&0!=n.status){var a={"ts-title":n.getResponseHeader("ts-title"),"ts-history":n.getResponseHeader("ts-history"),"ts-swap":n.getResponseHeader("ts-swap"),"ts-swap-push":n.getResponseHeader("ts-swap-push"),"ts-location":n.getResponseHeader("ts-location")};return r({ok:n.status>=200&&n.status<=299,status:n.status,url:n.responseURL,reqUrl:e,xhr:n,opts:t,headers:a,content:n.responseText})}},n.timeout=i,n.ontimeout=function(){return a({ok:!1,status:0,url:e,content:"timeout"})},n.send(t.body)}),xhr:n}}(d,l);return h.forEach(function(e){e.setAttribute("aria-busy","true"),e.classList.add(f),P(e)["active-xhr"]=p.xhr}),p.promise.then(function(e){if(S(()=>h.forEach(e=>{e.removeAttribute("aria-busy"),e.classList.remove("ts-active"),delete P(e)["active-xhr"]})),0==p.xhr.status&&"abort"==p.xhr.statusText)return!1;if(e.ok){if(e.headers["ts-location"])return function(e,t){return n.href=e,t}(e.headers["ts-location"],e);return e.url&&e.url!=new URL(d,n.href).href?(e.headers["ts-history"]||(e.headers["ts-history"]=e.url),e.swap=se(e.url,[t.body],e.content,e)):e.swap=se(a,h,e.content,e),e}return m("Something wrong with response",e.content),h.forEach(function(t){x(t,"ts-req-error",{response:e,url:d,opts:l})}),e}).catch(function(e){return S(()=>h.forEach(e=>{e.removeAttribute("aria-busy"),e.classList.remove("ts-active"),delete P(e)["active-xhr"]})),m("Error retrieving backend response",d,e.error||e),h.forEach(function(t){x(t,"ts-req-error",{response:e,url:d,opts:l})}),e})}function ce(e){return e=Array.isArray(e)?e:[e],Promise.all(e.map(function(e){e.opts=function(e){var t=G(e.el,e.event?.detail?.event??e.event);return{method:e.method,data:j(t,e.opts.data),xhr:{},headers:{Accept:"text/html+partial","TS-URL":n.pathname+n.search,"TS-Origin":R(e.el),"TS-Target":R(Q(e.el))}}}(e);var t={req:e,originalTarget:e.event.detail&&e.event.detail.originalTarget||e.event.target},r=N(e.el,"ts-req-before",t);if(r.defaultPrevented)return null;var a=e,o=ge(e.el,r,k(e.el,"ts-req-before"),t);o&&(a=o.then(function(t){return r.defaultPrevented?null:e}));var i=k(e.el,"ts-req-strategy")||"queue",s=P(e.el)["active-xhr"];return"first"===i&&s?null:("last"===i&&s&&(s.abort(),delete P(e.el)["active-xhr"]),a)})).then(function(e){return e.filter(function(e){return!!e})}).then(ue)}var le={reqs:[],request:null};function fe(){var e,t,n=(e=le.reqs,t=e=>e.method+e.url,e.reduce(function(e,n){var r=t(n);return(e[r]||(e[r]=[])).push(n),e},{}));for(var r in le={reqs:[],request:null},n)ce(n[r])}function de(e,t,n,r){var a=r?.url||k(e,n?"ts-req-batch":"ts-req")||("FORM"==e.tagName?k(e,"action"):k(e,"href")),o=(r?.method||k(e,"ts-req-method")||("FORM"==e.tagName?k(e,"method")||"POST":"GET")).toUpperCase();return{el:e,opts:{data:r?.data},event:t,url:a,method:o,batch:n}}function he(e,t){var n=e.tagName,r="click";"FORM"==n?r="submit":"INPUT"!=n&&"SELECT"!=n&&"TEXTAREA"!=n||(r="change");var a=null;return"FORM"==n&&"submit"==r&&O(e,'button, input[type="submit"]').forEach(e=>{I(e,"click",e=>{a=e.target})}),I(e,r,function(e){e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||0!=(e.button||0)||(e.preventDefault(),e.stopPropagation(),!e.submitter&&a&&"submit"==a.type&&(e.submitter=a),t(e),a=null)})}function pe(t,n,r){var a=e._ts_func&&e._ts_func[t]||p[t]||e[t];if(!a)throw Error("Unknown action command: "+r.src);return a.apply(r.el,n.concat([r]))}function me(e){var t=[],n=[],r=[],a="",o=0,i=0,s=0,u=null;function c(){var e=a.trim();e.length&&r.push(function(e){var t=e[0];return'"'==t||"'"==t?e.slice(1,e.length-1):e}(e)),a=""}function l(){r.length&&(n.push({src:e.slice(o,s).trim(),name:r[0],args:r.slice(1)}),r=[],o=s+1)}function f(){n.length&&(t.push({src:e.slice(i,s).trim(),commands:n}),n=[],i=s+1)}for(s=0;s<e.length;s++){var d=e[s];if(u)"\\"==d?(s++,a+=e[s]):d==u?(a+=d,u=null):a+=d;else{if("'"==d||'"'==d)u=d;else{if(" "==d){c();continue}if(","==d){c(),l();continue}if(";"==d){c(),l(),f();continue}}a+=d}}return c(),l(),f(),t}async function ve(e,t){console.debug("ACTION",e.src,t);var n=g({line:e.src},t),r=null;for(var a of e.commands){if(console.debug(!1!==r?"🔵":"🚫","COMMAND",a.src,{prev:r,src:e.src,el:n.el}),!1===r)return r;void 0!==r&&(n.input=r),n.command=a.name,n.src=a.src;try{r=await pe(a.name,a.args,n)}catch(t){throw g(t,{extra:{command:a.src,action:e.src,element:b(n.el)}})}}return r}function ge(e,t,n,r){if(n){console.debug("ACTIONS",{spec:n,event:t,payload:r});for(var a,o=me(n),i=g({el:e,event:t},r),s=0;s<o.length;s++){var u=o[s];u.commands.length&&(a=ve(u,i))}return a}}function be(e){var t=e.on,n=e.off,r=e.threshold;return new IntersectionObserver(function(e,a){for(var o=0;o<e.length;o++){var i=e[o];i.intersectionRatio>r?N(i.target,t,{entry:i}):i.intersectionRatio<r&&N(i.target,n,{entry:i})}},e)}D("[ts-req]",function(e){function t(t){ce([de(e,t,!1)])}q(e,"ts-trigger")?I(e,"ts-trigger",t):he(e,t)}),D("[ts-req-batch]",function(e){function t(t){var n;n=de(e,t,!0),le.reqs.push(n),le.request||(le.request=setTimeout(fe,16))}q(e,"ts-trigger")?I(e,"ts-trigger",t):he(e,t)}),D("[ts-action]",function(e){var t=function(t){t.detail&&t.detail.event&&(t=t.detail.event),ge(Q(e),t,k(e,"ts-action"),null)};q(e,"ts-trigger")?I(e,"ts-trigger",t):"A"==e.tagName||"BUTTON"==e.tagName?he(e,t):m("No trigger for action on element",e)});var ye=w(function(){return be({on:"visible",off:"invisible",rootMargin:"0px",threshold:.01})}),we=w(function(){return be({on:"closeby",off:"away",rootMargin:(e.innerHeight/2|0)+"px",threshold:.01})}),Te=w(function(){return new MutationObserver(function(e){for(var t=0;t<e.length;t++)for(var n=e[t],r=0;r<n.removedNodes.length;r++){N(n.removedNodes[r],"remove",{record:n})}})}),Ee=w(function(){return new MutationObserver(function(e){for(var t=0;t<e.length;t++){var n=e[t];if("childList"==n.type){var r=n.target.childNodes.count?"notempty":"empty";N(n.target,r,{record:n}),N(n.target,"childrenChange",{record:n})}}})});function Se(e,t,n,r){I(e,t,function a(o){n(o),P(e,"trigger",{}).once&&e.removeEventListener(t,a,r)},r)}function Ne(n,r,a){switch(r){case"load":S(function(){a(n,{type:"load"})});break;case"windowScroll":Se(e,"scroll",function(e){a(n,e)},{passive:!0});break;case"scroll":Se(n,"scroll",function(e){a(n,e)},{passive:!0});break;case"outside":Se(t,"click",function(e){n.contains(e.target)||a(n,e)},{capture:!0});break;case"remove":Te().observe(n.parentElement,{childList:!0}),I(n,r,function(e){a(n,e)});break;case"empty":case"notempty":case"childrenChange":Ee().observe(n,{childList:!0}),I(n,r,function(e){a(n,e)});break;case"visible":case"invisible":ye().observe(n),I(n,r,function(e){a(n,e)});break;case"closeby":case"away":we().observe(n),I(n,r,function(e){a(n,e)});break;default:Se(n,r,function(e){a(n,e)})}}function xe(e,t){var n=t.name,r=function(e){var t=e.args.indexOf("delay"),n={changed:-1!=e.args.indexOf("changed"),once:-1!=e.args.indexOf("once"),delay:-1!=t?T(e.args[t+1]):null};return function(e,t){var r=P(e,"trigger",{});function a(){N(e,"ts-trigger",{event:t,originalTarget:t.target},{bubbles:!1})}if(n.once){if(r.once)return;r.once=!0}if(n.changed){if(r.value==_(e))return;r.value=_(e)}n.delay?(r.delay&&clearTimeout(r.delay),r.delay=setTimeout(a,n.delay)):a()}}(t);Ne(e,n,r)}function qe(n){e.addEventListener("popstate",z),e.addEventListener("beforeunload",Y),F(t.body),d=!0,console.debug("init done",n)}D("[ts-trigger]",function(e){var t=k(e,"ts-trigger");t&&me(t)[0].commands.forEach(function(t){xe(e,t)})}),E(qe),e.performance?.navigation?.type==e.performance.navigation.TYPE_BACK_FORWARD&&z({state:"INITIAL"});var ke={onload:E,register:D,activate:F,func:function(e,t){return"object"==typeof e?g(p,e):(t&&(p[e]=t),p)},elcrumbs:M,arity:v,data:G,merge:j,target:Q,query:Q,trigger:N,parseAction:me,action:ge,exec:pe,makeReq:de,executeReqs:ce,morph:ne,setERR:e=>m=e,_internal:{DIRECTIVES:h,FUNCS:p,init:qe}};e.twinspark=ke}(window,document);