<!DOCTYPE html>
<html lang="en" class="text-base">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="{% block meta_description %}Intelligent meal planning and cooking optimization{% endblock %}">

    <title>{% block title %}imkitchen{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href={{ "/static/icons/icon-192.png?v=" ~ env!("CARGO_PKG_VERSION") }}>

    <!-- PWA Manifest -->
    <link rel="manifest" href={{ "/static/manifest.json?v=" ~ env!("CARGO_PKG_VERSION") }}>
    <meta name="theme-color" content="#2563eb">

    <!-- iOS PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="imkitchen">
    <link rel="apple-touch-icon" href={{ "/static/icons/apple-touch-icon.png?v=" ~ env!("CARGO_PKG_VERSION") }}>

    <!-- Critical CSS inlined for fast first paint (Story 5.9) -->
    <style>
        /* Reset and base styles */
        *, *::before, *::after { box-sizing: border-box; }
        html { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.5; -webkit-text-size-adjust: 100%; }
        body { margin: 0; background-color: #f9fafb; color: #111827; min-height: 100vh; display: flex; flex-direction: column; }

        /* Typography */
        h1, h2, h3, h4, h5, h6 { margin: 0; font-weight: 700; }
        h1 { font-size: 2rem; line-height: 2.5rem; }
        h2 { font-size: 1.5rem; line-height: 2rem; }
        h3 { font-size: 1.25rem; line-height: 1.75rem; }

        /* Layout utilities */
        .container { width: 100%; max-width: 80rem; margin-left: auto; margin-right: auto; padding-left: 1rem; padding-right: 1rem; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .flex-1 { flex: 1 1 0%; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .space-x-4 > * + * { margin-left: 1rem; }
        .space-x-6 > * + * { margin-left: 1.5rem; }

        /* Colors */
        .bg-white { background-color: #fff; }
        .bg-gray-50 { background-color: #f9fafb; }
        .text-primary-500 { color: #2563eb; }
        .text-gray-700 { color: #374151; }
        .text-gray-900 { color: #111827; }

        /* Navigation */
        nav { background-color: #fff; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); border-bottom: 1px solid #e5e7eb; }
        nav a { text-decoration: none; }

        /* Spacing */
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .pb-20 { padding-bottom: 5rem; }
        .min-h-screen { min-height: 100vh; }

        /* Responsive utilities */
        .hidden { display: none; }
        @media (min-width: 768px) {
            .md\:flex { display: flex; }
            .md\:py-4 { padding-top: 1rem; padding-bottom: 1rem; }
            .md\:pb-0 { padding-bottom: 0; }
            .md\:text-2xl { font-size: 1.5rem; line-height: 2rem; }
        }

        /* Skip link */
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }
    </style>

    <!-- Full CSS loaded asynchronously to avoid blocking render -->
    <link rel="preload" href={{ "/static/css/main.css?v=" ~ env!("CARGO_PKG_VERSION") }} as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href={{ "/static/css/main.css?v=" ~ env!("CARGO_PKG_VERSION") }}></noscript>

    <!-- Conditional polyfills for old browsers (minified inline) -->
    <script>!function(){if(!window.Promise||!window.fetch||!Array.prototype.includes||!Object.assign||"undefined"==typeof Symbol){var e=document.createElement("script");e.src="{{ "/static/js/polyfills.min.js?v=" ~ env!("CARGO_PKG_VERSION") }}",e.async=!1,document.head.appendChild(e)}}();</script>

    <!-- Core scripts (loaded on all pages) -->
    <script src={{ "/static/js/twinspark.min.js?v=" ~ env!("CARGO_PKG_VERSION") }} defer></script>

    <!-- PWA scripts (loaded on all pages for PWA functionality) -->
    <script src={{ "/static/js/pwa-install.min.js?v=" ~ env!("CARGO_PKG_VERSION") }} defer></script>
    <script src={{ "/static/js/sw-register.min.js?v=" ~ env!("CARGO_PKG_VERSION") }} defer></script>
    <script src={{ "/static/js/offline-indicator.min.js?v=" ~ env!("CARGO_PKG_VERSION") }} defer></script>
    <script src={{ "/static/js/feature-detection.min.js?v=" ~ env!("CARGO_PKG_VERSION") }} defer></script>

    <!-- Page-specific scripts (override in child templates) -->
    {% block page_scripts %}{% endblock %}

    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary-500 focus:text-white focus:rounded">
        Skip to main content
    </a>

    <!-- Navigation - Desktop/Tablet Top Bar -->
    {% block navigation %}
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="container mx-auto px-4 py-3 md:py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4 md:space-x-8">
                    <a href="/" class="text-xl md:text-2xl font-bold text-primary-500">
                        imkitchen
                    </a>

                    {% if user.is_some() %}
                    <!-- Authenticated navigation - hidden on mobile, shown on tablet+ -->
                    <div class="hidden md:flex space-x-6">
                        <a href="/dashboard" class="text-gray-700 hover:text-primary-500 font-medium">
                            Dashboard
                        </a>
                        <a href="/plan" class="text-gray-700 hover:text-primary-500 font-medium">
                            Meal Plan
                        </a>
                        <a href="/recipes" class="text-gray-700 hover:text-primary-500 font-medium">
                            Recipes
                        </a>
                        <a href="/shopping" class="text-gray-700 hover:text-primary-500 font-medium">
                            Shopping
                        </a>
                        <a href="/discover" class="text-gray-700 hover:text-primary-500 font-medium">
                            Discover
                        </a>
                    </div>
                    {% else %}
                    <!-- Public navigation -->
                    <div class="hidden md:flex space-x-6">
                        <a href="/discover" class="text-gray-700 hover:text-primary-500 font-medium">
                            Discover Recipes
                        </a>
                    </div>
                    {% endif %}
                </div>

                <div class="flex items-center space-x-3 md:space-x-4">
                    {% if user.is_some() %}
                    <!-- Mobile-only Discover icon -->
                    <a href="/discover" class="md:hidden text-gray-700 hover:text-primary-500 font-medium">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </a>
                    <!-- Desktop Profile link -->
                    <a href="/profile" class="text-gray-700 hover:text-primary-500 font-medium max-md:hidden">
                        Profile
                    </a>
                    <!-- Logout button -->
                    <form method="POST" action="/logout" class="inline">
                        <button type="submit" class="text-sm md:text-base text-gray-700 hover:text-primary-500 font-medium">
                            Logout
                        </button>
                    </form>
                    {% else %}
                    <!-- Auth links - responsive sizing -->
                    <a href="/login" class="text-sm md:text-base text-gray-700 hover:text-primary-500 font-medium">
                        Login
                    </a>
                    <a href="/register" class="bg-primary-500 text-white px-3 py-1.5 md:px-4 md:py-2 text-sm md:text-base rounded-lg hover:bg-primary-600 font-medium">
                        Sign Up
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>
    {% endblock %}

    <!-- Browser upgrade warning container (Story 5.7) -->
    <div id="browser-upgrade-warning" style="display: none;"></div>

    <!-- Feature warnings container (Story 5.7) -->
    <div id="feature-warnings" class="container mx-auto px-4 mt-4"></div>

    <!-- Main Content - Add bottom padding on mobile for bottom navigation -->
    <main id="main-content" class="flex-1 pb-20 md:pb-0">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    {% block footer %}
    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold text-gray-900 mb-4">imkitchen</h3>
                    <p class="text-gray-600 text-sm">
                        Intelligent meal planning and cooking optimization for busy households.
                    </p>
                </div>

                <div>
                    <h4 class="font-semibold text-gray-900 mb-4">Product</h4>
                    <ul class="space-y-2">
                        <li><a href="/discover" class="text-gray-600 hover:text-primary-500 text-sm">Discover Recipes</a></li>
                        {% if user.is_some() %}
                        <li><a href="/dashboard" class="text-gray-600 hover:text-primary-500 text-sm">Dashboard</a></li>
                        <li><a href="/subscription" class="text-gray-600 hover:text-primary-500 text-sm">Premium</a></li>
                        {% endif %}
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold text-gray-900 mb-4">Support</h4>
                    <ul class="space-y-2">
                        <li><a href="/help" class="text-gray-600 hover:text-primary-500 text-sm">Help Center</a></li>
                        <li><a href="/contact" class="text-gray-600 hover:text-primary-500 text-sm">Contact Us</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold text-gray-900 mb-4">Legal</h4>
                    <ul class="space-y-2">
                        <li><a href="/privacy" class="text-gray-600 hover:text-primary-500 text-sm">Privacy Policy</a></li>
                        <li><a href="/terms" class="text-gray-600 hover:text-primary-500 text-sm">Terms of Service</a></li>
                    </ul>
                </div>
            </div>

            <div class="border-t border-gray-200 mt-8 pt-8 text-center">
                <p class="text-gray-600 text-sm">
                    &copy; 2025 imkitchen. All rights reserved.
                </p>
            </div>
        </div>
    </footer>
    {% endblock %}

    <!-- Mobile Bottom Navigation (Story 5.4) - Only shown on mobile for authenticated users -->
    {% if user.is_some() %}
    {% include "components/nav-tabs.html" %}
    {% endif %}

    <!-- Back to Top Button (Story 5.4) - Shows on long pages -->
    {% include "components/back-to-top.html" %}

    {% block extra_scripts %}{% endblock %}
</body>
</html>
