<!DOCTYPE html>
<html lang="en" class="text-base">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{% block meta_description %}Intelligent meal planning and cooking optimization{% endblock %}">

    <title>{% block title %}imkitchen{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/static/icons/icon-192.png">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#2563eb">

    <!-- iOS PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="imkitchen">
    <link rel="apple-touch-icon" href="/static/icons/apple-touch-icon.png">

    <!-- Styles -->
    <link rel="stylesheet" href={{ "/static/css/main.css?v=" ~ env!("CARGO_PKG_VERSION") }}>

    <!-- TwinSpark for progressive enhancement -->
    <script src="/static/js/twinspark.min.js" defer></script>

    <!-- PWA installation prompt logic (Story 5.1) -->
    <script src="/static/js/pwa-install.js" defer></script>

    <!-- Service Worker registration (Story 5.2) -->
    <script src="/static/js/sw-register.js" defer></script>

    <!-- Offline indicator (Story 5.2) -->
    <script src="/static/js/offline-indicator.js" defer></script>

    <!-- Meal replacement modal interactions (Story 3.6 - CSP compliant) -->
    <script src="/static/js/meal-replacement.js" defer></script>

    <!-- Meal regeneration modal interactions (Story 3.7 - CSP compliant) -->
    <script src="/static/js/meal-regeneration.js" defer></script>

    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary-500 focus:text-white focus:rounded">
        Skip to main content
    </a>

    <!-- Navigation - Desktop/Tablet Top Bar -->
    {% block navigation %}
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="container mx-auto px-4 py-3 md:py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4 md:space-x-8">
                    <a href="/" class="text-xl md:text-2xl font-bold text-primary-500">
                        imkitchen
                    </a>

                    {% if user.is_some() %}
                    <!-- Authenticated navigation - hidden on mobile, shown on tablet+ -->
                    <div class="hidden md:flex space-x-6">
                        <a href="/dashboard" class="text-gray-700 hover:text-primary-500 font-medium">
                            Dashboard
                        </a>
                        <a href="/plan" class="text-gray-700 hover:text-primary-500 font-medium">
                            Meal Plan
                        </a>
                        <a href="/recipes" class="text-gray-700 hover:text-primary-500 font-medium">
                            Recipes
                        </a>
                        <a href="/shopping" class="text-gray-700 hover:text-primary-500 font-medium">
                            Shopping
                        </a>
                        <a href="/discover" class="text-gray-700 hover:text-primary-500 font-medium">
                            Discover
                        </a>
                    </div>
                    {% else %}
                    <!-- Public navigation -->
                    <div class="hidden md:flex space-x-6">
                        <a href="/discover" class="text-gray-700 hover:text-primary-500 font-medium">
                            Discover Recipes
                        </a>
                    </div>
                    {% endif %}
                </div>

                <div class="flex items-center space-x-3 md:space-x-4">
                    {% if user.is_some() %}
                    <!-- User menu - responsive sizing -->
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <a href="/profile" class="hidden md:inline text-gray-700 hover:text-primary-500 font-medium">
                            Profile
                        </a>
                        <form method="POST" action="/logout" class="inline">
                            <button type="submit" class="text-sm md:text-base text-gray-700 hover:text-primary-500 font-medium">
                                Logout
                            </button>
                        </form>
                    </div>
                    {% else %}
                    <!-- Auth links - responsive sizing -->
                    <a href="/login" class="text-sm md:text-base text-gray-700 hover:text-primary-500 font-medium">
                        Login
                    </a>
                    <a href="/register" class="bg-primary-500 text-white px-3 py-1.5 md:px-4 md:py-2 text-sm md:text-base rounded-lg hover:bg-primary-600 font-medium">
                        Sign Up
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>
    {% endblock %}

    <!-- Main Content - Add bottom padding on mobile for bottom navigation -->
    <main id="main-content" class="flex-1 pb-20 md:pb-0">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    {% block footer %}
    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold text-gray-900 mb-4">imkitchen</h3>
                    <p class="text-gray-600 text-sm">
                        Intelligent meal planning and cooking optimization for busy households.
                    </p>
                </div>

                <div>
                    <h4 class="font-semibold text-gray-900 mb-4">Product</h4>
                    <ul class="space-y-2">
                        <li><a href="/discover" class="text-gray-600 hover:text-primary-500 text-sm">Discover Recipes</a></li>
                        {% if user.is_some() %}
                        <li><a href="/dashboard" class="text-gray-600 hover:text-primary-500 text-sm">Dashboard</a></li>
                        <li><a href="/subscription" class="text-gray-600 hover:text-primary-500 text-sm">Premium</a></li>
                        {% endif %}
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold text-gray-900 mb-4">Support</h4>
                    <ul class="space-y-2">
                        <li><a href="/help" class="text-gray-600 hover:text-primary-500 text-sm">Help Center</a></li>
                        <li><a href="/contact" class="text-gray-600 hover:text-primary-500 text-sm">Contact Us</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold text-gray-900 mb-4">Legal</h4>
                    <ul class="space-y-2">
                        <li><a href="/privacy" class="text-gray-600 hover:text-primary-500 text-sm">Privacy Policy</a></li>
                        <li><a href="/terms" class="text-gray-600 hover:text-primary-500 text-sm">Terms of Service</a></li>
                    </ul>
                </div>
            </div>

            <div class="border-t border-gray-200 mt-8 pt-8 text-center">
                <p class="text-gray-600 text-sm">
                    &copy; 2025 imkitchen. All rights reserved.
                </p>
            </div>
        </div>
    </footer>
    {% endblock %}

    <!-- Mobile Bottom Navigation (Story 5.4) - Only shown on mobile for authenticated users -->
    {% if user.is_some() %}
    {% include "components/nav-tabs.html" %}
    {% endif %}

    <!-- Back to Top Button (Story 5.4) - Shows on long pages -->
    {% include "components/back-to-top.html" %}

    {% block extra_scripts %}{% endblock %}
</body>
</html>
