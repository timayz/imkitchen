<div id="shopping-list-content"
     ts-req="/shopping/refresh?week={{ selected_week }}"
     ts-req-method="GET"
     ts-trigger="every 2s"
     ts-swap="outerHTML">
{% if has_items %}
<!-- Shopping List Categories (Collapsible with Details/Summary) -->
<div class="space-y-4">
    {% for category in categories %}
    <details open class="category-card bg-white rounded-lg shadow-md border-l-4 {% match category.name.as_str() %}{% when "Produce" %}border-green-500{% when "Dairy" %}border-blue-500{% when "Meat" %}border-red-500{% when "Bakery" %}border-yellow-500{% when "Pantry" %}border-amber-600{% when "Frozen" %}border-cyan-500{% else %}border-gray-500{% endmatch %}">
        <summary class="p-6 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <svg class="chevron w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
                <h2 class="text-xl font-bold text-gray-900">{{ category.name }}</h2>
            </div>
            <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm font-medium">
                {{ category.item_count }} items
            </span>
        </summary>

        <div class="px-6 pb-6">
            <ul class="space-y-3">
                {% for item in category.items %}
                <li class="shopping-item flex items-center gap-3 p-2 hover:bg-gray-50 rounded transition-colors {% if item.is_collected %}collected-item{% endif %}" data-item-id="{{ item.id }}" data-collected="{{ item.is_collected }}" id="shopping-item-{{ item.id }}">
                    <form class="flex items-center gap-3 flex-1"
                          ts-req="/shopping/items/{{ item.id }}/check"
                          ts-req-method="POST"
                          ts-trigger="change"
                          ts-target="#shopping-item-{{ item.id }}">
                        <input
                            type="checkbox"
                            id="item-{{ item.id }}"
                            name="is_collected"
                            value="{% if item.is_collected %}false{% else %}true{% endif %}"
                            class="shopping-checkbox"
                            {% if item.is_collected %}checked{% endif %}
                            onchange="toggleItemCollected(this, '{{ item.id }}', this.checked);"
                        >
                        <label for="item-{{ item.id }}" class="flex-1 cursor-pointer {% if item.is_collected %}collected{% endif %}">
                            <span class="font-medium text-gray-900">{{ item.ingredient_name }}</span>
                            <span class="text-gray-600 ml-2">
                                {% if item.quantity != 0.0 %}
                                    {{ item.quantity }} {{ item.unit }}
                                {% endif %}
                            </span>
                        </label>
                    </form>
                </li>
                {% endfor %}
            </ul>
        </div>
    </details>
    {% endfor %}
</div>

<!-- Back to Dashboard -->
<div class="mt-8 no-print">
    <a href="/dashboard" class="inline-flex items-center text-primary-600 hover:text-primary-700 font-medium">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        Back to Dashboard
    </a>
</div>

{% else %}
<!-- No Shopping List -->
<div class="bg-white rounded-lg shadow-md p-12 text-center">
    <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 mb-4">
        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
        </svg>
    </div>
    <h2 class="text-2xl font-bold text-gray-900 mb-2">No Shopping List Yet</h2>
    <p class="text-gray-600 mb-6">Generate a shopping list from your active meal plan</p>
    <form action="/shopping/generate" method="post">
        <input type="hidden" name="week" value="{{ selected_week }}">
        <button type="submit" class="px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors inline-flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
            Generate Shopping List
        </button>
    </form>
    <div class="mt-6">
        <a href="/dashboard" class="text-gray-600 hover:text-gray-900">
            Back to Dashboard
        </a>
    </div>
</div>
{% endif %}
</div>
